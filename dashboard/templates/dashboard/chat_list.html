{% extends "dashboard/base.html" %}

{% block content %}
<div class="card">
    <div class="breadcrumb">Чаты пользователей</div>
    <form method="get" style="margin-bottom: 16px; display: flex; gap: 8px;">
        <input type="text" name="q" value="{{ query }}" placeholder="Поиск по username или chat_id"
               style="flex: 1; padding: 10px 14px; border-radius: 10px; border: 1px solid #d0d5dd;">
        <button type="submit" style="padding: 10px 18px; border-radius: 10px; border: none; background: #2563eb; color: #fff;">Найти</button>
    </form>

    {% if object_list %}
    <div style="display: flex; flex-direction: column; gap: 12px;">
        {% for thread in object_list %}
        <a href="{% url 'dashboard:chat_detail' thread.pk %}"
           style="text-decoration: none; color: inherit; border: 1px solid #e4e7ec; border-radius: 14px; padding: 14px 18px; display: flex; justify-content: space-between; align-items: center;">
            <div>
                <div style="font-weight: 600; font-size: 16px;">{{ thread.user.first_name }} {{ thread.user.last_name }} · @{{ thread.user.username|default:"—" }}</div>
                <div style="color: #475467; font-size: 14px; margin-top: 4px;">
                    {{ thread.last_message_text|default:"Нет сообщений" }}
                </div>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 13px; color: #94a3b8;">
                    {% if thread.last_message_at %}{{ thread.last_message_at|date:"d.m.Y H:i" }}{% else %}—{% endif %}
                </div>
                {% if thread.unread_count %}
                <div style="margin-top: 4px; background: #f97316; color: #fff; border-radius: 999px; padding: 2px 10px; font-size: 12px;">
                    {{ thread.unread_count }} новых
                </div>
                {% endif %}
            </div>
        </a>
        {% endfor %}
    </div>

    {% if is_paginated %}
    <div style="display: flex; justify-content: center; gap: 8px; margin-top: 18px;">
        {% if page_obj.has_previous %}
        <a href="?q={{ query }}&page={{ page_obj.previous_page_number }}">Назад</a>
        {% endif %}
        <span>Стр. {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
        {% if page_obj.has_next %}
        <a href="?q={{ query }}&page={{ page_obj.next_page_number }}">Вперёд</a>
        {% endif %}
    </div>
    {% endif %}
    {% else %}
    <p>Пока нет ни одного диалога.</p>
    {% endif %}
</div>
{% endblock %}
