{% extends "dashboard/base.html" %}

{% block content %}
<div class="card">
    <div class="breadcrumb">
        <a href="{% url 'dashboard:chat_list' %}" style="text-decoration: none;">← Все чаты</a>
        · {{ thread.user.first_name }} {{ thread.user.last_name }} (@{{ thread.user.username|default:"—" }})
    </div>
    <div style="margin-bottom: 18px; color: #475467;">
        Chat ID: <strong>{{ thread.user.chat_id }}</strong> · Сообщений: {{ messages_total }}
    </div>
    <div style="display: flex; flex-direction: column; gap: 12px;">
        {% for message in messages %}
        <div style="
            align-self: {% if message.direction == 'incoming' %}flex-start{% else %}flex-end{% endif %};
            max-width: 75%;
            background: {% if message.direction == 'incoming' %}#f8fafc{% else %}#2563eb{% endif %};
            color: {% if message.direction == 'incoming' %}#111{% else %}#fff{% endif %};
            padding: 12px 16px;
            border-radius: 18px;
        ">
            <div style="font-size: 12px; opacity: 0.8; margin-bottom: 6px;">
                {% if message.direction == 'incoming' %}Пользователь{% else %}Бот{% endif %}
                · {{ message.message_date|date:"d.m.Y H:i" }}
            </div>
            {% if message.text %}
            <div style="white-space: pre-wrap;">{{ message.text }}</div>
            {% endif %}
            {% if message.media_file_id %}
                {% if message.media_mime_type|default:""|slice:":5" == "image" %}
                    <div style="margin-top: 8px;">
                        <img src="{% url 'dashboard:message_media' message.pk %}"
                             alt="Медиа"
                             style="max-width: 100%; border-radius: 12px;">
                    </div>
                {% else %}
                    <div style="margin-top: 8px;">
                        <a href="{% url 'dashboard:message_media' message.pk %}"
                           style="color: {% if message.direction == 'incoming' %}#2563eb{% else %}#e0e7ff{% endif %};">
                            Скачать вложение ({{ message.media_mime_type|default:"файл" }})
                        </a>
                    </div>
                {% endif %}
            {% endif %}
        </div>
        {% empty %}
        <p>Сообщений пока не найдено.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
