# Telegram Mini App - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø–ª–∞—Ç—ã —Ç–æ–∫–µ–Ω–æ–≤

## –û–ø–∏—Å–∞–Ω–∏–µ

Telegram Mini App –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–æ—Ç–∞. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±—Ä–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –æ–ø–ª–∞—Ç–∏—Ç—å –∏—Ö —á–µ—Ä–µ–∑ –∫–∞—Ä—Ç—É VISA/MasterCard.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
miniapp/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ api.py                  # API endpoints –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
‚îú‚îÄ‚îÄ views.py                # Django views
‚îú‚îÄ‚îÄ README.md               # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îú‚îÄ‚îÄ index.html         # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ Mini App
‚îÇ   ‚îú‚îÄ‚îÄ styles.css         # CSS —Å—Ç–∏–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ payment.js         # JavaScript –ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ templates/
‚îî‚îÄ‚îÄ payment_providers/
    ‚îî‚îÄ‚îÄ __init__.py
```

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

1. **–í—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–∫–µ–Ω–æ–≤**
   - 100 —Ç–æ–∫–µ–Ω–æ–≤ = $5
   - 200 —Ç–æ–∫–µ–Ω–æ–≤ = $10
   - 500 —Ç–æ–∫–µ–Ω–æ–≤ = $25
   - 1000 —Ç–æ–∫–µ–Ω–æ–≤ = $50

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
   - –í–∞–ª–∏–¥–∞—Ü–∏—è init_data –æ—Ç Telegram Web App
   - –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ç–µ–º—É Telegram

3. **–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã**
   - –ö–∞—Ä—Ç–∞ VISA/MasterCard (KZ/CHF)

4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç Telegram Web App
   - CSRF –∑–∞—â–∏—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ init_data

## API Endpoints

### POST /api/miniapp/create-payment
–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞

**Request Body:**
```json
{
  "email": "user@example.com",
  "credits": 100,
  "amount": 5.0,
  "currency": "USD",
  "payment_method": "card",
  "user_id": 123456789,
  "init_data": "query_id=..."
}
```

**Response:**
```json
{
  "success": true,
  "payment_url": "https://payment.example.com/...",
  "payment_id": "123"
}
```

### GET /api/miniapp/payment-status/{payment_id}
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞

**Response:**
```json
{
  "success": true,
  "status": "pending",  // –∏–ª–∏ "completed", "failed"
  "amount": 5.0,
  "created_at": "2025-10-24T12:00:00Z"
}
```

### POST /api/miniapp/payment-webhook
Webhook –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback –æ—Ç –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
python manage.py runserver
```

–û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:8000/miniapp/

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º

–í –∫–æ–¥–µ –±–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```python
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton, WebAppInfo

keyboard = InlineKeyboardMarkup(inline_keyboard=[
    [InlineKeyboardButton(
        text="üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å",
        web_app=WebAppInfo(url=f"{PUBLIC_BASE_URL}/miniapp/")
    )]
])
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```env
PUBLIC_BASE_URL=https://your-domain.com
TELEGRAM_BOT_TOKEN=your_bot_token
```

## TODO: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –≤–∫–ª—é—á–∞–µ—Ç –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –î–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. **–í—ã–±—Ä–∞—Ç—å –ø–ª–∞—Ç–µ–∂–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä:**
   - Stripe
   - Kaspi.kz
   - PayPal
   - –î—Ä—É–≥–∏–µ

2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ `miniapp/payment_providers/`:**
   - –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   - –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

3. **–û–±–Ω–æ–≤–∏—Ç—å `miniapp/api.py`:**
   - –ó–∞–º–µ–Ω–∏—Ç—å TODO –≤ `create_payment()`
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `payment_webhook()`

## –î–∏–∑–∞–π–Ω

–î–∏–∑–∞–π–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ —Å–æ–≥–ª–∞—Å–Ω–æ –º–∞–∫–µ—Ç—É:
- –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω (#1a1a1a)
- –°–µ—Ä—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (#2d2d2d)
- –ë–µ–ª—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å—Ç–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ Telegram init_data
- CSRF –∑–∞—â–∏—Ç–∞ –Ω–∞ –≤—Å–µ—Ö endpoints
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

## –õ–∏—Ü–µ–Ω–∑–∏—è

–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—Ä–æ–µ–∫—Ç tg-nanobanana
