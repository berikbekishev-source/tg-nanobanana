# üß™ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ Lava.top

## üìã –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ Lava.top

1. **–í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç:**
   ```
   https://lava.top/login
   ```

2. **–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º:**
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí API ‚Üí –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
   - –í–∫–ª—é—á–∏—Ç–µ –æ–ø—Ü–∏—é "Test Mode"
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

3. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç:**
   - –ü—Ä–æ–¥—É–∫—Ç—ã ‚Üí –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç
   - –ù–∞–∑–≤–∞–Ω–∏–µ: "TEST - 100 Tokens"
   - –¶–µ–Ω–∞: $5.00
   - –û—Ç–º–µ—Ç—å—Ç–µ "–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç"

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –¥–ª—è —Ç–µ—Å—Ç–æ–≤:**
   - Webhooks ‚Üí –î–æ–±–∞–≤–∏—Ç—å webhook
   - URL: –í–∞—à webhook endpoint
   - –°–æ–±—ã—Ç–∏—è: Payment Success, Payment Failed
   - –í–∫–ª—é—á–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –≤–µ–±—Ö—É–∫–∏"

### 2. –ú–µ—Ç–æ–¥—ã –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –≤–µ–±—Ö—É–∫–æ–≤

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Railway (–ü—Ä–æ–¥–∞–∫—à–Ω)

```bash
# –ü–æ–ª—É—á–∏—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π URL –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
railway status

# URL –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤ –±—É–¥–µ—Ç:
https://your-app.railway.app/api/miniapp/lava-webhook
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å ngrok

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok
brew install ngrok/ngrok/ngrok

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
python manage.py runserver

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok —Ç—É–Ω–Ω–µ–ª—å
ngrok http 8000

# 4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok URL –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤
https://abc123.ngrok.io/api/miniapp/lava-webhook
```

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ webhook.site

```bash
# 1. –û—Ç–∫—Ä–æ–π—Ç–µ webhook.site
https://webhook.site

# 2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π URL
https://webhook.site/unique-id

# 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```

### 3. –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã Lava.top

Lava.top –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:

| –ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã | –†–µ–∑—É–ª—å—Ç–∞—Ç | CVV | –°—Ä–æ–∫ |
|-------------|-----------|-----|------|
| 4111 1111 1111 1111 | –£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂ | 123 | 12/25 |
| 4000 0000 0000 0002 | –û—Ç–∫–ª–æ–Ω–µ–Ω–æ –±–∞–Ω–∫–æ–º | 123 | 12/25 |
| 4000 0000 0000 0069 | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ | 123 | 12/25 |
| 4000 0000 0000 0127 | –¢—Ä–µ–±—É–µ—Ç—Å—è 3D Secure | 123 | 12/25 |
| 4000 0000 0000 3055 | –¢–∞–π–º–∞—É—Ç –ø–ª–∞—Ç–µ–∂–∞ | 123 | 12/25 |

### 4. API endpoints –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫:
```
X-Test-Mode: true
```

### 5. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

#### –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç —Å Railway:

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export LAVA_API_KEY="HUavlwH154yV1KjiTbEKnZJyHxem7W0SgE7iIKsbq6MlSjNMulkOS3GgYEadREEb"
export RAILWAY_PUBLIC_DOMAIN="your-app.railway.app"

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
python lavatop/tests/test_real_webhooks.py

# 3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç 1 (Railway webhook)
```

#### –õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Å ngrok:

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Django —Å–µ—Ä–≤–µ—Ä
python manage.py runserver

# 2. –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
python lavatop/tests/test_real_webhooks.py

# 3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç 2 (Local + ngrok)
```

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ Railway:

```bash
# –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
railway logs --service web | grep "Lava webhook"

# –ò–ª–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
railway open
```

#### –õ–æ–∫–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

```bash
# Django –ª–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã
tail -f logs/payment.log
```

### 7. –¢–∏–ø–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```python
# 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
POST /api/miniapp/create-payment
{
  "email": "test@example.com",
  "credits": 100,
  "amount": 5.00,
  "currency": "USD"
}

# 2. –ü–æ–ª—É—á–µ–Ω–∏–µ payment_url
{
  "payment_url": "https://pay.lava.top/form/test_123",
  "payment_id": "test_123"
}

# 3. –û–ø–ª–∞—Ç–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ä—Ç–æ–π (–≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—Ä—Ç—É: 4111 1111 1111 1111

# 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–µ–±—Ö—É–∫–∞ –æ—Ç Lava.top
POST /api/miniapp/lava-webhook
{
  "order_id": "test_123",
  "status": "success",
  "amount": 5.00,
  "test_mode": true
}

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
GET /api/miniapp/payment-status/test_123
{
  "status": "completed",
  "tokens_credited": 100
}
```

### 8. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –°–æ–∑–¥–∞–π—Ç–µ bash —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞:

```bash
#!/bin/bash
# test_payment_flow.sh

echo "üöÄ Starting payment test flow..."

# 1. –°–æ–∑–¥–∞–µ–º –ø–ª–∞—Ç–µ–∂
PAYMENT_RESPONSE=$(curl -s -X POST \
  http://localhost:8000/api/miniapp/create-payment \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "credits": 100,
    "amount": 5.00
  }')

PAYMENT_ID=$(echo $PAYMENT_RESPONSE | jq -r '.payment_id')
echo "‚úÖ Payment created: $PAYMENT_ID"

# 2. –°–∏–º—É–ª–∏—Ä—É–µ–º –æ–ø–ª–∞—Ç—É (–µ—Å–ª–∏ API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
curl -X POST \
  https://api.lava.top/test/complete-payment \
  -H "Authorization: Bearer $LAVA_API_KEY" \
  -H "X-Test-Mode: true" \
  -d "{\"payment_id\": \"$PAYMENT_ID\"}"

echo "‚úÖ Payment completed in test mode"

# 3. –ñ–¥–µ–º –≤–µ–±—Ö—É–∫
echo "‚è≥ Waiting for webhook..."
sleep 5

# 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
STATUS=$(curl -s \
  http://localhost:8000/api/miniapp/payment-status/$PAYMENT_ID \
  | jq -r '.status')

if [ "$STATUS" = "completed" ]; then
  echo "‚úÖ Test passed! Payment completed successfully"
else
  echo "‚ùå Test failed! Status: $STATUS"
fi
```

### 9. –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –≤–µ–±—Ö—É–∫–∞–º–∏

#### –ï—Å–ª–∏ –≤–µ–±—Ö—É–∫–∏ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å URL:**
   ```bash
   curl -X POST https://your-webhook-url \
     -H "Content-Type: application/json" \
     -d '{"test": true}'
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Lava.top:**
   - –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç ‚Üí Webhooks ‚Üí –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–æ–∫

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
   - Firewall –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–∞–ª–∏–¥–Ω—ã–π (–¥–ª—è HTTPS)

4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ webhook.site –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:**
   - –í—Ä–µ–º–µ–Ω–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤—å—Ç–µ –≤–µ–±—Ö—É–∫–∏ –Ω–∞ webhook.site
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Lava.top –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

### 10. CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

#### GitHub Actions:

```yaml
name: Test Payment System

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Setup Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        pip install -r requirements.txt

    - name: Run payment tests
      env:
        LAVA_API_KEY: ${{ secrets.LAVA_API_KEY }}
        TEST_MODE: true
      run: |
        python lavatop/tests/test_real_webhooks.py
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–µ—Å—Ç–æ–≤

### Dashboard –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π**
2. **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å –≤–µ–±—Ö—É–∫–æ–≤**
3. **–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞**
4. **–û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏**

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```python
import logging

logger = logging.getLogger('payment.test')

# –õ–æ–≥–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø
logger.info(f"Test payment created: {payment_id}")
logger.info(f"Webhook received: {webhook_data}")
logger.info(f"Balance updated: {new_balance}")
```

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤ Lava.top
- [ ] Webhook URL –¥–æ—Å—Ç—É–ø–µ–Ω –ø—É–±–ª–∏—á–Ω–æ
- [ ] API –∫–ª—é—á –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –í–µ–±—Ö—É–∫–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- [ ] –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- [ ] –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –õ–æ–≥–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **Lava.top Support:** support@lava.top
- **API Documentation:** https://lava.top/docs/api
- **Test Console:** https://lava.top/test-console